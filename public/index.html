<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
	<link rel="stylesheet" type="text/css" href="/assets/styles/salesforce-lightning-design-system.css" />
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.js" ></script>
	
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

	<script src= 
	"https://code.jquery.com/jquery-3.5.1.min.js" 
					integrity= 
	"sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" 
					crossorigin="anonymous"> 
		  </script> 
    
 
    <script type="text/javascript">
        (function() {
            var config = {
                baseUrl: 'js'
            };

            var dependencies = [
                'customActivity'
            ];

            require(config, dependencies);
		})();
			
    </script>
    
    
    <style type="text/css">
    body 
		{
            padding: 20px;
            margin: 0;
	        background-color: #ffffff;
        }
	.fileName
	{
		color:black;

	}
	.imageContainer
		{
		
		border: solid;
		border-color: #2196f3;
		border-radius: 5px;
		width: 30%;
		height: 125px;
		margin: 8px;
		padding: 5px;
		float: left;
	
		}
    .step 
		{
            display: none;
        }
    #step1 {
            display: block;
        }
	html 
		{
			background: #ffffff;
	    }
    .editor
        {
			border:solid 1px #ccc;
			padding: 20px;
			min-height:200px;
        }
    .sample-toolbar
        {
			border:solid 1px #ddd;
			background:#f4f4f4;
			padding: 5px;
			border-radius:3px;
        }
    .sample-toolbar > span
        {
			cursor:pointer;
		}
    .sample-toolbar > span:hover
        {
			text-decoration:underline;
		}
	.noselect 
		{  
		   -webkit-touch-callout: none; /* iOS Safari */   
		   -webkit-user-select: none; /* Safari */    
		   -khtml-user-select: none; /* Konqueror HTML */   
		   -moz-user-select: none; /* Old versions of Firefox */   
		   -ms-user-select: none; /* Internet Explorer/Edge */ 
		    user-select: none; /* Non-prefixed version, currently supported by Chrome, Edge, Opera and Firefox */
	    }
	#limit,#limitWhatsapp
		{
			display:none;
		}
	.previewTable
	{
			height: 100%;
			width:100%;
	}
	.smscol, .wpCol
	{
			display:inline-block;
	}
	




	a.dfn-hover {
		color: #333;
		text-decoration: none;
	}
	
	
	dfn {
	 
	  padding: 0 0.4em;
	  font-weight: 400;
	  font-style: normal;
	  position: relative;
	  
	}
	dfn::after {
	  content: attr(data-info);
	  display: inline;
	  position: absolute;
	  top: 22px; left: 0;
	  opacity: 0;
	  width: 170px;
	  font-size: 13px;
	  font-weight: 400;
	  line-height: 1.5em;
	  padding: 0.5em 0.8em;
	  background: rgba(0,0,0,0.8);
	  color: #fff;
	  pointer-events: none; /* This prevents the box from apearing when hovered. */
	  transition: opacity 250ms, top 250ms;
	  text-align:center;
	}
	dfn::before {
	  content: '';
	  display: block;
	  position: absolute;
	  top: 12px; left: 20px;
	  opacity: 0;
	  width: 0; height: 0;
	  border: solid transparent 5px;
	  border-bottom-color: rgba(0,0,0,0.8);
	  transition: opacity 250ms, top 250ms;
	}
	dfn:hover {z-index: 2;} /* Keeps the info boxes on top of other elements */
	dfn:hover::after,
	dfn:hover::before {opacity: 1;}
	dfn:hover::after {top: 30px; right:50px;}
	dfn:hover::before {top: 20px;right:50px;}

	
/* Modal CSS for the images display */	      
    .modal 
		{
  			display: none; /* Hidden by default */
			position: fixed; /* Stay in place */
			z-index: 1; /* Sit on top */
			padding-top: 100px; /* Location of the box */
			left: 0;
			top: 0;
			width: 100%; /* Full width */
			height: 100%; /* Full height */
			overflow: auto; /* Enable scroll if needed */
			background-color: rgb(0,0,0); /* Fallback color */
			background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
		}

/* Modal Content for the image display*/
	.modal-content 
		{
			background-color: #fefefe;
			margin: auto;
			padding: 20px;
			border: 1px solid #888;
			width: 80%;
		}

/* The Close Button */
    .close 
	    {
			color: #aaaaaa;
			float: right;
			margin-left: 569px;
			font-size: 28px;
			font-weight: bold;
		}

	.close:hover,
	.close:focus 
		{
			color: #000;
			text-decoration: none;
			cursor: pointer;
		}
	
    </style>
</head>

	
	
<body>

<!-- This is step 1-->
<div id="step1" class="step">
	
	<div class="slds-text-heading_small instruction">Enter authentication values for twilio.</div>
    <br>
	<!-- enter twilio authentication details-->
	<div class="form-group" >  
	<div id = "error"></div> 
</div>
	<!-- enter AccountSID -->
<div class="form-group">
    <div><label class="slds-text-heading_small instruction" for="accountSID">Account SID:<span class="required" style = "color: red">*</span></label></div>
        <input class="form-control" id="accountSID" type="text" name="accountSID" value="" aria-describedby="required-description" required="true"> 
	</div>
	<!-- enter Auth Token -->
    <div class="form-group">
    <div><label class="slds-text-heading_small instruction" for="authToken">Auth Token:<span class="required" style = "color: red">*</span></label></div>
        <input class="form-control" id="authToken" type="text" name="authToken" value="" required="true" aria-describedby="required-description"> 
	</div> 	

	<button onclick="fetchMSID()" style="border: none;padding: 10px;margin-left: 282px;margin-top: 8px;border-radius: 8px;background-color: #d2f4f4;">GET MESSAGING SERVICES</button>
	
<br><br>


	<!-- select Messeging service -->
	<div class="slds-text-heading_small instruction">Select Messaging service:</div> 
	<div class="slds-form-element__control">
		    <div class="slds-select_container">
		      <select class="slds-select" id="messageservice" onchange="messagingServiceChange()" onfocus="this.selectedIndex = -1;">  
				<option value = "" selected>None</option>	  
			    <!-- <option value="Sessionalval">Sessional</option>
				<option value="Sessional Message val">Sessional Message</option>
				<option value="Message val">Message</option> -->
			    
		      </select>
		    </div>
        </div> 
	<br><br> 
	<table style="font-size: 1rem;">
		<tr>
			<td>Name: <span id="MSname"></span></td>
			<td>MSID: <span id="Msid"></span></td>
		</tr>
	</table>

</div>
<!-- Step 1 ends  --> 



<!-- This is step 2 -->
<div id="step2" class="step">

<!-- select checkbox  -->
<div class="slds-text-heading_small instruction">Select channels. The user will be sent messages on the channels you are selecting.</div>
<br>
<!--checkbox error  -->
<div class="slds-form-element">
<div id = "checkboxcheck"></div>
</div> 

<!-- SMS checkbox  -->
<div class="slds-form-element">
  <div class="slds-form-element__control">
    <div class="slds-checkbox">
      <input type="checkbox" name="options" id="SMS" value=""  />
      <label class="slds-checkbox__label" for="SMS">
        <span class="slds-checkbox_faux"></span>
        <span class="slds-form-element__label">SMS</span>
      </label>
    </div>
 </div>
</div>
 	
<!-- WhatsApp checkbox  -->
<div class="slds-form-element">
  <div class="slds-form-element__control">
    <div class="slds-checkbox">
        <input type="checkbox" name="options" id="WhatsApp" value="" onchange="summaryImageDisplay();"/>
        <label class="slds-checkbox__label" for="WhatsApp">
        <span class="slds-checkbox_faux"></span>
        <span class="slds-form-element__label">WhatsApp</span>
        </label>
    </div>
  </div>
</div> 
<br><br>

<!-- WhatsApp details -->
<div id = "wholeDiv" >

	<!-- Message type(Sessional/transactional) selection dropdown  -->
	<div id = "WatsappOptionDiv" class="slds-text-heading_small instruction">Select WhatsApp message type:</div> 
	<div id = "WatsappOptionDivInfo" class="slds-form-element__control">
		    <div class="slds-select_container">
		      <select class="slds-select" id="messageType" onchange="MessageTypeChange()">  
				<option hidden selected>None</option>	  
			    <option value="Sessional Message">Sessional Message</option>
			    <option value="Transactional Message">Transactional Message</option>
		      </select>
		    </div>
        </div> 
	<br><br>

	<!-- Transactional message template selection dropdown  -->
	<div id = "WatsappTemplateDiv" class="slds-text-heading_small instruction">Select Template for WhatsApp:</div> 
	<div id = "WatsappTemplateDivInfo" class="slds-form-element__control">
		    <div class="slds-select_container">
		      <select class="slds-select" id="template" onchange="templateChange()" >
				<option hidden selected>None</option>
			    <option value="Your appointment is coming up on {{1}} at {{2}}">Appointment Reminder</option>
			    <option value="Your {{1}} order of {{2}} has shipped and should be delivered on {{3}}. Details: {{4}}">Order Confirmation</option>
			    <option value="Your {{1}} code is {{2}}">Verification Code</option>
			    <!--onfocus="this.selectedIndex = -1;" -->
		      </select>
		    </div>
		</div> 

</div>
<br><br>
	
<!-- Message recipient not selected error   -->
<div class="slds-form-element">
</div> 

<!-- Select recipient   -->
<div class="slds-text-heading_small instruction">Select recipient</div> 
<div class="slds-form-element">  
		  <div class="slds-form-element__control">
		    <div class="slds-select_container">
		      <select class="slds-select" id="recipient" onchange="recipientChange()">
			      <option hidden selected>None</option>
			     <!-- //onfocus="this.selectedIndex = -1;"-->
		      </select>
		    </div>
		  </div> 
	</div>
	
</div>
<!-- Step 2 ends  -->	
	


<!-- Step 3 begins  -->	
<div id="step3" class="step" class="step noselect">

<!--To add the error if message body is null-->
<div id='beforeContenteditableDiv'>
<div class="slds-form-element">
	</div> 

<!-- Create a message  -->
<div class="slds-text-heading_small instruction noselect" id="heading">Create a message:</div>
<div id = "messageBodyNull"> </div>
<div style="background-color: #fdea3d8a;padding: 8px;margin-top: 10px;border-radius: 6px;" id="limitVal">
<p id="limitsms">SMS Messages with length more than 160 are sent as segments and are charged extra.</p>
<p id="limitWhatsapp">WhatsApp Messages with length more than 1600 are sent as segments and are charged extra.</p>
</div>
<br><br>

<!-- Formatting tools  -->
    <div class="sample-toolbar noselect">
		<a href="javascript:void(0)" onclick="format('bold')"><span class="fa fa-bold fa-fw"></span></a>
		<a href="javascript:void(0)" onclick="format('italic')"><span class="fa fa-italic fa-fw"></span></a>
	    
		<a href="javascript:void(0)" onclick="format('strikeThrough')"><span class="fa fa-strikethrough fa-fw"></span></a>
		<a href="javascript:void(0)" onclick="format('cut')"><span class="fa fa-cut fa-fw"></span></a>
	    <!-- <a href="javascript:void(0)" onclick="format('underline')"><span class="fa fa-underline fa-fw"></span></a> -->
	    <a href="javascript:void(0)" onclick="format('undo')"><span class="fa fa-undo fa-fw"></span></a>
		<a href="javascript:void(0)" onclick="format('redo')"><span class="fa fa-redo fa-fw"></span></a>
		<button id="myBtn" style ="display: none;" ><span class="fa fa-image fa-fw"></span></button>
	    <div class="slds-form-element"> <!--personalization string insertion dropdown-->
		    <div class="slds-form-element__control">
		    <div class="slds-select_container">
				
		    <select class="slds-select" id="ps" onchange="insertAttribute()" >
			<option value="none" style="font-weight: 650;" id="none" selected>Select Attribute</option>
			<!--<option value="{{Contact.Attribute.TwilioV1.EmailAddress}}" id="ps1">Email</option>
			<option value="{{Contact.Attribute.TwilioV1.TwilioNumber}}" id="ps2">Phone number</option> -->
		    </select>
		    </div>
		    </div>
		</div>    
		<div class="slds-text-heading_small instruction" style="text-align:right;"><dfn data-info="The character count doesn't includes personalization strings because its length can be variable.">Message Length:</dfn> <span id='char-count'></span></div>
		
    </div>
</div>
<!-- content editable div to create a message body  -->

<div id="RichTextEditor" class="editor" contenteditable='true'></div>

<div id = 'afterContenteditableDiv'> 

<!--  Display the selected image message  -->
<!-- <h3 id="selected">SELECTED IMAGE: </h3> -->
<br>
<div class="slds-text-heading_small instruction noselect" id="selected">SELECTED IMAGE: </div>
<div  id="image"></div> <!-- Div to show image after it is selected  -->
<p id="fileName"></p>
<!-- hidden checkbox to see if the image is inserted or not  -->
<input type="checkbox" name="options" id="isInserted" value=""  style="display:none;"/>
<p id="fileURL" style="display:none;"></p>
<p id="fileType" style="display:none;"></p>

</div>

<!-- The Modal to display the images after we click on image button. An api called on server side and returs the URL of images-->
<div id="myModal" class="modal">

<!-- Modal content -->
<div class="modal-content">
    <span class="close" style="float:right;">&times;</span> <!-- cross button to close the modal  -->
    <h2 style="text-align:center;">SELECT THE IMAGE</h2>
	<br><br>

<!-- Div to show images after API callout  -->
<div id="showFile"></div> 
</div>
</div>


</div>
<!-- Step 3 ends  -->


<!-- Step 4 starts  -->
<div id="step4" class="step">

<!-- Display channels on summary page 
 <div class="slds-text-heading_small instruction">CHANNEL</div>
<div id="channel"> </div> 		
<br><br> -->

<table class ="previewTable" style="width:100%">
	<tr>
		<td id="smscol" style="text-align: center;padding-top: 13%;width:50%; height:509px;background-repeat: no-repeat; background-image:url('images/phone.jpg');background-size: 90% 103%"><div id="selectedPhonesms" style="background-color: #03a9f4;width: 64%;margin-left: 51px;padding: 17px;border-radius: 6px;margin-bottom: 27px;margin-top: -71px;font-size: 19px;color: white;font-weight: bold;"></div><div id="smsPreview" style="background-color:rgb(194 228 244);width: 50%;margin-left: 18%; padding-bottom: 10px;border-radius:10px; padding-left: 10px;padding-right: 3px;padding-top: 9px;text-align: left;overflow-y: auto; max-height: 92%;"></div></td>
		<td id="wpCol" style="text-align: center;padding-top: 13%;width:50%; height:509px;background-repeat: no-repeat; background-image:url('images/phone.jpg');background-size: 90% 103%;"><div id="selectedPhonewp" style="background-color: #03a9f4;width: 64%;margin-left: 51px;padding: 17px;border-radius: 6px;margin-bottom: 27px;margin-top: -71px;font-size: 19px;color: white;font-weight: bold;"></div><div style="background-color:rgb(243, 243, 243);width:50%;border-radius: 7px;margin-left: 16%;    overflow-y: auto;max-height: 92%;overflow-x: hidden;"><div id="imageinserted" class="summaryImage" style="margin: 5px;width:100%"></div><div id="whatsappPreview"  style=" width: 100%;margin-left:1%;padding-bottom: 10px;border-radius:10px; padding-left: 10px;padding-right: 3px;padding-top: 9px;text-align: left;"></div></div></td>
	</tr>
</table>


</div>







<script>

//Code for character count
var keyArrayindex = [];
$('#char-count').text('0');

//Function to set values for
function setKeyVal(keyArray){
	console.log("function called to set value");
		for(var keyval in keyArray){
			var test1 = '{{' + keyArray[keyval] +'}}';
			keyArrayindex.push(test1);
		}
	//keyArrayindex = keyArray;
	console.log("value set---" + keyArrayindex);

}
$('#RichTextEditor').bind('keyup keydown', function() {
  var count = $('#char-count');
  var characters = $(this).text().length;
  console.log($(this).text());
  console.log($(this).text().length);
  var text = $(this).text();
  console.log("-------------------");
  console.log("-------------------This is the original text value-------------------------------" + text);
  console.log("-------------------");
    	for(var keyval in keyArrayindex)
		{
		console.log("keyval----->" + keyArrayindex[keyval]);
  		text= text.replaceAll(keyArrayindex[keyval],'');
  		console.log(text);
  		console.log(text.length);
		}
		console.log("Text after excluding attributes----" + text);
    characters = text.length;
  if (characters > 160 && characters<1600){
	document.getElementById("limitVal").style.display = "block";
	document.getElementById("limitsms").style.display = "block";
	document.getElementById("limitWhatsapp").style.display = "none";
   }
   else if(characters > 1600)
   {
	document.getElementById("limitVal").style.display = "block";
   document.getElementById("limitsms").style.display = "block";
   document.getElementById("limitWhatsapp").style.display = "block";
   }
   else
   {

	document.getElementById("limitVal").style.display = "none";
	document.getElementById("limitsms").style.display = "none";
	document.getElementById("limitWhatsapp").style.display = "none";
   }
  count.text(characters);
});



// Get the modal
var modal = document.getElementById("myModal");

// Get the button that opens the modal
var btn = document.getElementById("myBtn");

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];
		
//Formatting
function format(command, value) 
{
	document.execCommand(command, false, value);
}

//Formatting
function execVal(command, value) 
{
	document.execCommand(command, false, value);
}
		
//This function calls another function to insert the attribute string into the content editable div
function insertAttribute() 
{
	
	var value = $("#ps").val(); //retrieve the value you want to insert
	console.log('value------------------->' + value);
	insertTextAtCaret(value);   //Pass the value to the insert text function	
}

//This function os called to insert the attribute value at cursor position
function insertTextAtCaret(text)
{	
    var sel, range;
	console.log( ' window.getSelection'  + window.getSelection);
    if (window.getSelection) 
            {
                var x = document.getElementById("ps").value;
                if(x!='none')
                  {
                sel = window.getSelection();
            
                console.log("selection----------------->" + sel); 
                console.log("window.getSelection().anchorNode.parentNode.id----->" + window.getSelection().anchorNode.parentNode.id);
                console.log("window.getSelection().anchorNode.parentNode.parentNode.id ----->" + window.getSelection().anchorNode.parentNode.parentNode.id);
                console.log("window.getSelection().anchorNode.id---------------->" + window.getSelection().anchorNode.id);
                console.log("window.getSelection().id--------------------------->" + window.getSelection().id);
                var parentID = window.getSelection().anchorNode.parentNode.id;
                var anchorID = window.getSelection().anchorNode.id;
                var superparentID = window.getSelection().anchorNode.parentNode.parentNode.id ; 
                //console.log("yeh hai parent Id" + parentID) ;
                //console.log("yeh hai anchor Id" + anchorID) ;
                if(parentID == 'RichTextEditor' || anchorID == 'RichTextEditor' || superparentID == 'RichTextEditor') 
                {
                    if (sel.getRangeAt && sel.rangeCount) 
                    {
                        range = sel.getRangeAt(0);
                        console.log("yeh range ahi --- >  " + range);
                        range.deleteContents();
                        range.insertNode( document.createTextNode(text) );
                    }
                }
              else if (document.selection && document.selection.createRange) 
            {
                if ( window.getSelection().anchorNode.parentNode.id ==  "RichTextEditor" )
                {
                    console.log("I don't know what this is" + document.selection.createRange().text);
                    document.selection.createRange().text = text;
                    console.log("Text-------->" + text);
                }
        }
        document.getElementById('none').selected=true;
    }
    }
}

//Function to insert image when selected
function imageinsert(url,type,filename)
	{
		console.log("url as it is received by the insert image function--->" + url);
		console.log("filename----->" + filename);
		console.log(" type------>" +type);
		console.log("We are inserting the image now");
		document.getElementById('whatsappPreview').style.display= "Block";
		
		if(type == 'Document')
		{
			document.getElementById('image').innerHTML = '<img id= "' + 'insertedSerialNo' + '" style="margin:3px;" src="/assets/icons/doctype/pdf_120.png" width="100" height="120"><span class="close" style="float:right;" onclick = "removeimage();">&times;</span></img>';
			console.log(document.getElementById('image').innerHTML);
			document.getElementById('imageinserted').innerHTML ='<img style="margin:3px;" src="/assets/icons/doctype/pdf_120.png" width="100" height="120"></img>';
			document.getElementById('whatsappPreview').style.display= "none";
			
		}
		else if(type == 'Image')
		{
			document.getElementById('image').innerHTML = '<img id= "' + 'insertedSerialNo' + '" style="margin:3px;" src="' + url + '" width="100" height="120"><span class="close" style="float:right;" onclick = "removeimage();">&times;</span></img>';
			console.log(document.getElementById('image').innerHTML);
			document.getElementById('imageinserted').innerHTML ='<img style="margin:3px;" src="' + url + '" width="100" height="120"></img>';	
		}
		else if(type == 'Audio')
		{
			document.getElementById('image').innerHTML = '<img id= "' + 'insertedSerialNo' + '" style="margin:3px;" src="/assets/icons/doctype/audio_120.png" width="100" height="120"><span class="close" style="float:right;" onclick = "removeimage();">&times;</span></img>';
			console.log(document.getElementById('image').innerHTML);
			document.getElementById('imageinserted').innerHTML ='<img style="margin:3px;" src="/assets/icons/doctype/audio_120.png" width="100" height="120"></img>';	
			document.getElementById('whatsappPreview').style.display= "none";
		}
		else
		{
				console.log("Other file types not supported");
		}
			document.getElementById('fileName').textContent = filename;
			document.getElementById('fileURL').textContent = url;
			document.getElementById('fileType').textContent = type;

		
		//replace the html of image section on step 3
		//document.getElementById('image').innerHTML = '<img id= "' + 'insertedSerialNo' + '" style="margin:3px;" src="/assets/icons/doctype/audio_120.png" width="100" height="120"><span>'+ filename +'</span><span class="close" style="float:right;" onclick = "removeimage();">&times;</span></img>';
		//console.log(document.getElementById('image').innerHTML);
		//Set the checkbox value to true as image is inserted
		document.getElementById("isInserted").checked = true;
		//Close the modal as we have inserted the image now
		modal.style.display = "none";
		//replace the html with image in the summary page
		//document.getElementById('imageinserted').innerHTML ='<img style="margin:3px;" src="' + url + '" width="100" height="120"></img>';

	}
	
function summaryImageDisplay()
	{
		//This function is called when the checkbox value of WhatsApp is changed.
		//We will hide/show the image on summary page based on this value
		var whatsappsms = $("#WhatsApp").is(":checked");  // get the WP checkbox value
		var x = document.getElementById('imageinserted'); //get the checkbox id

		// Show/hide whatsapp related dropdowns based on checkbox value
		if(whatsappsms == true)
        {
			//Show
			document.getElementById("wholeDiv").style.display = "block";
			console.log("We are showing the selected image in summary block");
			x.style.display = "block";
        }
		else
		{      
			//hide 
			document.getElementById("wholeDiv").style.display = "none";
			console.log("It is coming on else part");
			x.style.display = "none";
		}
	}

// This function selects the recipient from dropdown	
function recipientChange()
	{
		console.log("We are selecting the reciepient here.");
		var value = $("#recipient").val(); //Get and store the selected phone number value
		console.log("Selected phone number" + value); 
	}
	


// When the user clicks the button, open the modal 
btn.onclick = function() 
{
  	modal.style.display = "block";	
  	document.getElementById("showFile").innerHTML = '';
  	var url = '/imagesContent';  	
	fetch( url, {
                   method: "POST",
                   headers: {"Content-Type": "application/json"}
                }).then(response => response.json())
                .then((body) => 
                {
                	//var map = {};
					var map = body.urlmap;
					console.log("url map" + JSON.stringify(body.urlmap));
					console.log("url map" + JSON.stringify(map));
					var index = 1;
					for(const [key,value] of Object.entries(map))
					{
						console.log(key);
						console.log(value);
						var id = 'serialNo' + index ;
						var nameStr =  value.filename;
						var shortFileName;
						var nameLen = nameStr.length;
						if(nameLen > 20){
							shortFileName = nameStr.slice(0, 20);
							shortFileName += '...';
							console.log("shortFileName" +shortFileName );
						}else{
							shortFileName =  value.filename;
						}
						if(value.type == 'Document'){
							console.log("print doc");
							document.getElementById("showFile").innerHTML += '<div width="33%" class="imageContainer"><img id="' +  index + '" src="/assets/icons/doctype/pdf_120.png" onclick="imageinsert(\'' + key + '\', \''+ value.type +'\',\''+ value.filename+'\')"style="margin:3px;height: 79%;width: auto;"><br><dfn data-info=\"'+ value.filename +'\">'+ shortFileName +'</dfn></div>';

							

						}else if(value.type == 'Image'){
							console.log("print image");
							document.getElementById("showFile").innerHTML += '<div width="33%" class="imageContainer"><img id="' +  index + '" src="' + key + '" onclick="imageinsert(\'' + key + '\', \''+ value.type +'\',\''+ value.filename+'\')"style="margin:3px;height: 79%;width: auto;"><br><dfn data-info=\"'+ value.filename +'\">'+ shortFileName +'</dfn></div>';


						}else if(value.type == 'Audio'){
								console.log("print audio");
								document.getElementById("showFile").innerHTML += '<div width="33%" class="imageContainer"><img id="' +  index + '" src="/assets/icons/doctype/audio_120.png" onclick="imageinsert(\'' + key + '\', \''+ value.type +'\',\''+ value.filename+'\')" style="margin:3px;height: 79%;width: auto;"><br><dfn data-info=\"'+ value.filename +'\">'+ shortFileName +'</dfn></div>';

						}else{
							console.log("invadid file format");
						}
						console.log(index);
						index++;

					}
					
					/*arry.forEach(myFunction);  
					function myFunction(item, index) {
					var id = 'serialNo' + index ; 
					//console.log("this is image id------>" + id);
					document.getElementById("showimage").innerHTML += '<img id="' +  id + '" src="' + item + '" onclick="imageinsert(\'' + item + '\')" width="100" height="120" style="margin:3px;">';
				}*/
		        // console.log(document.getElementById("showimage").innerHTML);
		  
		 })

}

// When the user clicks on <span> (x), close the modal
span.onclick = function() 
{
  modal.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) 
{
  if (event.target == modal) {
    modal.style.display = "none";
  }
}

//Remove the image when we click on cross button in step 3. Also remove it from summary page
function removeimage()
{
	console.log("this function will be called to remove the image");
	document.getElementById('image').innerHTML = ' '; 
	document.getElementById("isInserted").checked = false;
	//remove image from summary
	document.getElementById('imageinserted').innerHTML ='';	
	document.getElementById('fileURL').textContent = "";
	document.getElementById('fileName').textContent= "";
	document.getElementById('fileType').textContent = "";
	document.getElementById('whatsappPreview').style.display= "Block";
}
	
	
// actions to perform when the message type is changing
function MessageTypeChange(){
	console.log("message type is changing here");
	var value = $("#messageType").val();
	console.log("#messageType value   : " + value);
	var btn1 = document.getElementById('myBtn');
	if(value == "Sessional Message")
		{
		console.log("---Sessional message--- ");
		$('#template').attr('disabled',true);
		btn1.style.display = 'block' ;
		document.getElementById('RichTextEditor').innerHTML = "";
		document.getElementById('template').selectedIndex = "0";
	   }
	else if(value == "Transactional Message")
		{
		console.log("Transactional Message Button");
		$('#template').attr('disabled',false);		 	
		console.log("Style ",btn.style.display);
		btn1.style.display =  'none';
		console.log("after style  ",btn.style.display);
		}
	
}

//Actions to perform when the template type is changing
function templateChange()
	{
	    console.log("Template is selected here");
		var value = $("#template").val();
		var len = value.length;
		document.getElementById('RichTextEditor').innerHTML = value;
		document.getElementById('char-count').textContent = len;
	}

// function called when messaging service is selected
function messagingServiceChange()
{
	var ms=	document.getElementById("messageservice").value;
	var mstext = document.getElementById("messageservice");
	var text = mstext.options[mstext.selectedIndex].text;
	console.log(ms);
	console.log(text);
	document.getElementById("Msid").innerHTML = ms;
	document.getElementById("MSname").innerHTML = text;
}

// messagingServiceChange
function fetchMSID()	
	{
		console.log("This function is called to set the messaging service id");
		var id = $('#accountSID').val();
		var token = $('#authToken').val();
		document.getElementById('messageservice').innerHTML ="";
		 //,body:{"accountsid":id, "authToken": token}
		 //.then(response => console.log(response.json()))
		 console.log(id +'--------' + token);
		 var dataSMID = {};
		 dataSMID.accountSID = id;
		 dataSMID.authToken = token;
		
			$.ajax
               ({
                url: '/messagingID',
                data: JSON.stringify(dataSMID),
				contentType: 'application/json',
                type: "POST",
                success: function (data) {
                    console.log("data--------------->"+data);
					console.log("data--------------->"+JSON.stringify(data));
					console.log("data--------------->"+JSON.stringify(data.map));
					var MSIDmap = data.map;
					
					for(const [key,value] of Object.entries(MSIDmap))
					{
						document.getElementById('messageservice').innerHTML +=  '<option value =' + key + '>'+ value +'</option>' ;

					}
					//

                   
                }
              })
	};

</script>		
</body>
</html>